<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>Excel 檔案預覽</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #999; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
    #dateDisplay { font-size: 18px; margin-top: 10px; color: #333; }
  </style>
</head>
<body>
  <h2>上傳 Excel 並預覽內容</h2>
  <input type="file" id="upload" accept=".xlsx" />
  <div id="dateDisplay"></div>
  <div id="excelData"></div>

  <script>
    document.getElementById('upload').addEventListener('change', function (e) {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function (e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const sheetName = workbook.SheetNames[0];
        const worksheet = workbook.Sheets[sheetName];
        const json = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

        // 顯示日期（依檔案名稱解析）
        const fileName = file.name;
        const match = fileName.match(/^(\d{2})(\d{2})(\d{2})/);
        if (match) {
          const year = '20' + match[1];
          const month = match[2];
          const day = match[3];
          const fullDate = `${year}/${month}/${day}`;
          document.getElementById('dateDisplay').textContent = `檔案日期：${fullDate}`;
        } else {
          document.getElementById('dateDisplay').textContent = '無法從檔名辨識日期';
        }

        // 顯示資料
        const table = document.createElement('table');
        json.forEach((row, i) => {
          const tr = document.createElement('tr');
          row.forEach(cell => {
            const cellElement = document.createElement(i === 0 ? 'th' : 'td');
            cellElement.textContent = cell !== undefined ? cell : '';
            tr.appendChild(cellElement);
          });
          table.appendChild(tr);
        });

        const container = document.getElementById('excelData');
        container.innerHTML = '';
        container.appendChild(table);
      };

      reader.readAsArrayBuffer(file);
    });
  </script>
</body>
</html>
